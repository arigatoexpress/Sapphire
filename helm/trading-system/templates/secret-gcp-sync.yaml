{{- /*
  Secret Management Strategy:
  - When secrets.helmManaged=false (default for production): 
    This template is SKIPPED. Secrets are managed by scripts/sync-secrets.sh
  - When secrets.helmManaged=true:
    Helm creates an empty placeholder secret (for development/testing)
*/ -}}
{{- if and .Values.secrets.syncFromGcp .Values.secrets.helmManaged }}
apiVersion: v1
kind: Secret
metadata:
  name: cloud-trader-secrets
  namespace: {{ .Values.global.namespace | default "trading" }}
  labels:
    {{- include "trading-system.labels" . | nindent 4 }}
    app: secrets
  annotations:
    "helm.sh/hook": pre-install,pre-upgrade
    "helm.sh/hook-weight": "-5"
    "helm.sh/resource-policy": keep
type: Opaque
data:
  # Placeholder - actual values populated by sync-secrets.sh
  ASTER_API_KEY: ""
  ASTER_SECRET_KEY: ""
  TELEGRAM_BOT_TOKEN: ""
  TELEGRAM_CHAT_ID: ""
  DATABASE_URL: ""
  DB_PASSWORD: ""
  {{- if .Values.secrets.includeGrok }}
  GROK4_API_KEY: ""
  {{- end }}
  {{- if .Values.secrets.includeGemini }}
  GEMINI_API_KEY: ""
  {{- end }}
{{- else if .Values.secrets.syncFromGcp }}
# Secret 'cloud-trader-secrets' is managed externally by scripts/sync-secrets.sh
# Set secrets.helmManaged=true to have Helm manage this secret instead
{{- end }}
